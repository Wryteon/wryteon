---
import { validateSession } from "../lib/auth";

export interface Props {
  children: any;
}

const { children } = Astro.props;

// Extract session token from cookies
const cookies = Astro.request.headers.get("cookie") || "";
const sessionToken = cookies
  .split(";")
  .find((c) => c.trim().startsWith("session="))
  ?.split("=")[1];

// Validate session
const session = sessionToken ? await validateSession(sessionToken) : null;

// If no valid session, redirect to login
if (!session) {
  return Astro.redirect("/auth/login");
}
---

<slot />
